
# Application Implementation Pattern: Spring Boot MVC JPA PostgreSQL

Author: AI Agent
Version: 1.1.0
Date: 2025-09-12
Description: Application implementation pattern for building RESTful services with Spring Boot MVC, Spring Data JPA, and PostgreSQL, including Flyway migrations, Actuator, Springdoc OpenAPI, Lombok, Testcontainers, and turn-level file aggregation via ai-append.

---

# Spring Boot MVC + JPA + PostgreSQL

## Purpose

Build a production-grade REST API using Spring Boot MVC, Spring Data JPA, and PostgreSQL. Standardize schema evolution (Flyway), docs (Springdoc), observability (Actuator), developer ergonomics (Lombok), testing (JUnit 5 + Testcontainers), and turn artifact aggregation (`ai-append.sh`).

## When to Use

* Synchronous request/response HTTP APIs.
* Relational consistency with transactional boundaries.
* Migration-driven schema ownership (Flyway).
* Operational visibility and API discovery out of the box.

## Do Not Use If

* End-to-end reactive backpressure or ultra-high concurrency (prefer WebFlux + R2DBC).
* Document-first or multi-model persistence (e.g., MongoDB).
* Streaming/event-first pipelines (consider Kafka/outbox).

## Tech Stack

* Language/Runtime: Java 21
* Framework: Spring Boot 3.5.5
* Web: Spring MVC (spring-boot-starter-web)
* Persistence: Spring Data JPA
* Database: PostgreSQL 16.x
* Migrations: Flyway
* API Docs: Springdoc OpenAPI (webmvc UI)
* Observability: Spring Boot Actuator
* Ergonomics: Lombok
* Testing: JUnit 5, Testcontainers (PostgreSQL)
* Build: Maven
* Aggregation: ai/project-parser/ai-append.sh (turn file concatenation)

## Coordinates (defaults)

* groupId: com.example
* artifactId: app
* version: 0.0.1-SNAPSHOT
* packaging: jar
* java.version: 21
* spring-boot.version: 3.5.5

---

## Artifacts Produced (Concrete)

1. pom.xml (generated from pattern → dependencies, plugins, pins)
2. src/main/resources/application.yml (baseline config; env-only substitutions, no fallbacks)
3. src/main/resources/db/migration/V1\_\_init.sql (placeholder)
4. Optional scaffolding: HelloController, Entity, Repository, Service
5. ai/project-parser/output/ai-files.md (generated by ai-append.sh at turn end)

### application.yml (generated)

Path: src/main/resources/application.yml

```yaml
spring:
  application:
    name: ${APP_NAME}

  datasource:
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        show_sql: false

  flyway:
    enabled: true
    locations: classpath:db/migration

server:
  port: ${APP_PORT}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always
  health:
    db:
      enabled: true

springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
```

Required environment variables (no defaults):
APP\_NAME, APP\_PORT, DB\_HOST, DB\_PORT, DB\_NAME, DB\_USERNAME, DB\_PASSWORD

---

## Tool Registry (Pattern-Specific)

### 1) generate\_pom\_from\_pattern

Purpose: Synthesize a complete pom.xml from the selected pattern set.
Inputs:

* maven.groupId, maven.artifactId, maven.name, maven.description
* javaVersion (default 21), bootVersion (default 3.5.5)
* build.useParent (default true)
* patterns: \[spring-mvc-rest, spring-data-jpa, postgres, flyway, springdoc-openapi, actuator, validation, lombok]
* plugins: \[spring-boot, maven-compiler, surefire, failsafe]
* coordinates.version (default 0.0.1-SNAPSHOT)
* ci.reproducibleBuild (boolean; sets outputTimestamp)
  Outputs: pom.xml (single resolved file)
  Rules:
* Use Spring Boot parent when useParent=true; otherwise import BOM.
* Add Testcontainers junit-jupiter and postgresql modules when postgres is present.
* Conflict: spring-webflux must not co-exist with spring-mvc-rest.

### 2) emit\_application\_yaml

Purpose: Write baseline application.yml with env-only placeholders.
Inputs: APP\_NAME, APP\_PORT, DB\_HOST, DB\_PORT, DB\_NAME, DB\_USERNAME, DB\_PASSWORD
Outputs: src/main/resources/application.yml

### 3) create\_flyway\_baseline

Purpose: Create initial migration file.
Inputs: optional schema name
Outputs: src/main/resources/db/migration/V1\_\_init.sql (placeholder)

### 4) verify\_env

Purpose: Pre-flight check for required env vars (no fallbacks).
Inputs: list of required keys
Outputs: pass/fail with explicit missing keys

### 5) ai\_append\_workspace\_files

Purpose: Aggregate AI workspace and project pipeline files into ai-files.md for the turn.
Executable: ai/project-parser/ai-append.sh (Version 1.5)
Inputs: none (uses repo layout)
Outputs: ai/project-parser/output/ai-files.md
Contract details (mirrors script behavior):

* Computes BASE\_DIR, AI\_DIR, PROJECT\_ROOT.
* Excludes common build/venv/temp dirs and ai/project-parser itself to avoid recursion.
* Includes text-based artifacts only; skips binaries and archives.
* Adds project\_root/AGENTS.md explicitly if present.
* Adds project\_root/agentic-pipeline tree explicitly if present.
* Post-processes ai-files.md to replace the literal prefix
  .//Users/bobware/projects/0-codex-starters/java-spring-boot-codex-starter/
  with project\_root/
* Cross-platform sed -i handling via `sedi` function.
* Emits a line count at completion.

Invocation example:
bash ai/project-parser/ai-append.sh

---

## Task Graph (Minimal CQRS-lite for scaffolding)

### Task: initialize\_app.task.md

Depends on: verify\_env
Runs:

1. verify\_env(APP\_NAME, APP\_PORT, DB\_HOST, DB\_PORT, DB\_NAME, DB\_USERNAME, DB\_PASSWORD)
2. generate\_pom\_from\_pattern
3. emit\_application\_yaml
4. create\_flyway\_baseline

Outputs:

* pom.xml
* application.yml
* V1\_\_init.sql

### Task: create\_persistence\_layer.task.md

Depends on: initialize\_app
Runs:

* Generate JPA entity, repository, service stubs
* Add sample schema changes to V1\_\_init.sql or V2\_\_\*.sql

### Task: create\_rest\_service\_task.task.md

Depends on: initialize\_app
Runs:

* Generate MVC controller under /api/v1
* Configure validation, exception handler, OpenAPI annotations

### Task: verify\_and\_build.task.md

Depends on: create\_persistence\_layer, create\_rest\_service\_task
Runs:

* mvn -q -DskipTests=false test
* mvn -q -DskipITs=false verify

### Task: append\_turn\_artifacts.task.md

Depends on: verify\_and\_build
Runs:

* ai\_append\_workspace\_files

Outputs:

* ai/project-parser/output/ai-files.md

---

## Dependency Set (pattern → artifact)

* Web API: org.springframework.boot\:spring-boot-starter-web
* Validation: org.springframework.boot\:spring-boot-starter-validation
* Persistence: org.springframework.boot\:spring-boot-starter-data-jpa
* JDBC driver: org.postgresql\:postgresql (runtime)
* Migrations: org.flywaydb\:flyway-core
* Observability: org.springframework.boot\:spring-boot-starter-actuator
* OpenAPI: org.springdoc\:springdoc-openapi-starter-webmvc-ui
* Lombok: org.projectlombok\:lombok (provided/optional)
* Testing (unit): org.springframework.boot\:spring-boot-starter-test (test)
* Testing (containers): org.testcontainers\:junit-jupiter (test), org.testcontainers\:postgresql (test)

## Build Plugins

* org.springframework.boot\:spring-boot-maven-plugin (layered jars)
* maven-compiler-plugin (release 21; annotation processors for Lombok/MapStruct if present)
* maven-surefire-plugin (JUnit Platform)
* maven-failsafe-plugin (integration-test/verify phase)

---

## Implementation Checklist (Tool-Aligned)

1. Run initialize\_app.task.md → generates pom.xml, application.yml, V1 migration.
2. Implement domain: Entities, Repos, Services; update migrations.
3. Implement REST controllers; enable validation; add @ControllerAdvice; verify Springdoc UI.
4. Enable Actuator endpoints; confirm readiness/health.
5. Run verify\_and\_build.task.md → unit + integration tests (Testcontainers PostgreSQL).
6. Run append\_turn\_artifacts.task.md → produces ai-files.md with project\_root/ path rewriting.

---

## Notes

* Env policies: never use default fallbacks in `${...}` within generated config.
* Parent vs BOM: `build.useParent=true` recommended for simplicity; BOM mode is supported if needed.
* The pattern explicitly codifies ai-append as a terminal step each turn to snapshot all relevant AI and pipeline files.
